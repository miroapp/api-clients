## Miro API clients

This repository contains Miro API clients and the tools needed to generate them, based on the OpenAPI specification (OAS).
Currently, the only available client is the [Node.js client](./packages/typescript-node), written in [TypeScript](https://www.typescriptlang.org/).

## Install dependencies

After cloning the repository, install the dependencies by running the following command:

```bash
yarn
```

## Update OpenAPI specification

API clients are generated using `@openapitools/openapi-generator-cli`. They are generated based on the API specifications defined in the `spec.json` file.

The `update-spec` command downloads separate OpenAPI specification files, and then merges them into a single one. \
The `./scripts/fetch-spec.mjs` script downloads and merges the specification. \
Each endpoint in the specification must have a unique `operationId`, because the client method names are derived from it.

To update the `spec.json` specs file, run the following command:

```bash
yarn update-spec
```

## Generate the `typescript-node` client

To generate the `typescript-node` client, run the following command:

```bash
yarn generate
```

The command produces:

1. Low-level client methods
2. High-level client methods and models
3. JavaScript code, compiled from the source TypeScript code.

### 1. Low-level client methods

The command generates low-level code in the `api` and `model` subdirectories.
This command runs `openapi-generator-cli` with the `typescript-node` generator, based on the Mustache template files in the `typescript-node-template` directory.

### 2. High-level client methods and models

This command executes `./generator/generate_node_highlevel_models.ts`, which generates high-level client models that use the low-level client code generated with `openapi-generator-cli`. \
This is based on the model definitions in the `./generator/modelDefinition.ts` file.

To customize autogenerated models:

1. Define additional classes in the `highlevel` directory.
2. Update the extended [model definition](/packages/generator/modelDefinition.ts) to point to the new file. \
   To view an example, see [`packages/typescript-node/highlevel/Team.ts`](/packages/typescript-node/highlevel/Team.ts) for an example.
   
   To view the generated model hierarchy, see [MODELS.md](./MODELS.md).

### 3. Compiling to JavaScript

As a final step, the command runs `yarn build` to compile the source TypeScript code to JavaScript, and to generate `.d.ts` files.

## Build the documentation

Documentation for the client is generated with [TypeDoc](https://typedoc.org/).

To build the documentation, run the following command:

```bash
yarn build:docs
```

The resulting static HTML files and their related assets are in the `docs-out` directory. 

## Publish the client

When the version in `package.json` changes, the [`publish`](https://github.com/miroapp/api-clients/actions/workflows/publish.yml) GitHub action publishes the  `packages/typescript-node` content to the *npm* registry as [`@mirohq/miro-node`](https://www.npmjs.com/package/@mirohq/miro-node).

## Publish the documentation

The [`pages-build-deployment`](https://github.com/miroapp/api-clients/actions/workflows/pages/pages-build-deployment) GitHub action publishes the client documentation to [GitHub pages](https://miroapp.github.io/api-clients/).
